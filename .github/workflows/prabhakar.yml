â€Žname: Continuous Persistent VPS
â€Ž 
â€Žon:
â€ŽÂ  schedule:
â€ŽÂ Â Â  - cron: '0 */6 * * *'Â  # Every 6 hours
â€ŽÂ  workflow_dispatch:
â€Ž 
â€Žjobs:
â€ŽÂ  vps-session:
â€ŽÂ Â Â  runs-on: ubuntu-latest
â€ŽÂ Â Â  timeout-minutes: 350Â  # Just under 6 hours
â€Ž 
â€ŽÂ Â Â  steps:
â€ŽÂ Â Â Â Â  - name: Checkout repo
â€ŽÂ Â Â Â Â Â Â  uses: actions/checkout@v4
â€Ž 
â€ŽÂ Â Â Â Â  - name: Set hostname to biralo
â€ŽÂ Â Â Â Â Â Â  run: sudo hostnamectl set-hostname biralo
â€Ž 
â€ŽÂ Â Â Â Â  - name: Download VPS backup (if any)
â€ŽÂ Â Â Â Â Â Â  uses: actions/download-artifact@v4
â€ŽÂ Â Â Â Â Â Â  with:
â€ŽÂ Â Â Â Â Â Â Â Â  name: vps-backup
â€ŽÂ Â Â Â Â Â Â Â Â  path: ./backup
â€ŽÂ Â Â Â Â Â Â  continue-on-error: true
â€Ž 
â€ŽÂ Â Â Â Â  - name: Install prerequisites
â€ŽÂ Â Â Â Â Â Â  run: |
â€ŽÂ Â Â Â Â Â Â Â Â  sudo apt update
â€ŽÂ Â Â Â Â Â Â Â Â  sudo apt install -y tmate curl unzip sudo net-tools neofetch
â€Ž 
â€ŽÂ Â Â Â Â  - name: Install Tailscale official script
â€ŽÂ Â Â Â Â Â Â  run: |
â€ŽÂ Â Â Â Â Â Â Â Â  curl -fsSL https://tailscale.com/install.sh | sh
â€Ž 
â€ŽÂ Â Â Â Â  - name: Restore backup files
â€ŽÂ Â Â Â Â Â Â  run: |
â€ŽÂ Â Â Â Â Â Â Â Â  if [ -f ./backup/backup.zip ]; then
â€ŽÂ Â Â Â Â Â Â Â Â Â Â  unzip -o ./backup/backup.zip -d /
â€ŽÂ Â Â Â Â Â Â Â Â  else
â€ŽÂ Â Â Â Â Â Â Â Â Â Â  echo "No backup found, starting fresh"
â€ŽÂ Â Â Â Â Â Â Â Â  fi
â€Ž 
â€ŽÂ Â Â Â Â  - name: Restore Tailscale state
â€ŽÂ Â Â Â Â Â Â  run: |
â€ŽÂ Â Â Â Â Â Â Â Â  if [ -f /opt/vps-backup/data/tailscaled.state ]; then
â€ŽÂ Â Â Â Â Â Â Â Â Â Â  sudo mkdir -p /var/lib/tailscale
â€ŽÂ Â Â Â Â Â Â Â Â Â Â  sudo cp /opt/vps-backup/data/tailscaled.state /var/lib/tailscale/tailscaled.state
â€ŽÂ Â Â Â Â Â Â Â Â Â Â  sudo chmod 600 /var/lib/tailscale/tailscaled.state
â€ŽÂ Â Â Â Â Â Â Â Â  fi
â€Ž 
â€ŽÂ Â Â Â Â  - name: Start Tailscale
â€ŽÂ Â Â Â Â Â Â  run: |
â€ŽÂ Â Â Â Â Â Â Â Â  sudo tailscaled &
â€ŽÂ Â Â Â Â Â Â Â Â  sleep 8
â€ŽÂ Â Â Â Â Â Â Â Â  sudo tailscale up --authkey ${{ secrets.TAILSCALE_AUTHKEY }} --hostname=biralo || echo "Tailscale already up"
â€Ž 
â€ŽÂ Â Â Â Â  - name: Create user biralo with sudo
â€ŽÂ Â Â Â Â Â Â  run: |
â€ŽÂ Â Â Â Â Â Â Â Â  if ! id -u biralo >/dev/null 2>&1; then
â€ŽÂ Â Â Â Â Â Â Â Â Â Â  sudo useradd -m -s /bin/bash biralo
â€ŽÂ Â Â Â Â Â Â Â Â Â Â  echo "biralo:biralo" | sudo chpasswd
â€ŽÂ Â Â Â Â Â Â Â Â Â Â  sudo usermod -aG sudo biralo
â€ŽÂ Â Â Â Â Â Â Â Â Â Â  echo "biralo ALL=(ALL) NOPASSWD:ALL" | sudo tee /etc/sudoers.d/biralo
â€ŽÂ Â Â Â Â Â Â Â Â  fi
â€Ž 
â€ŽÂ Â Â Â Â  - name: Start tmate session for SSH access
â€ŽÂ Â Â Â Â Â Â  uses: mxschmitt/action-tmate@v3
â€Ž 
â€ŽÂ Â Â Â Â  - name: Show Tailscale IP and tmate info
â€ŽÂ Â Â Â Â Â Â  run: |
â€ŽÂ Â Â Â Â Â Â Â Â  echo "ðŸ”— Tailscale IP:"
â€ŽÂ Â Â Â Â Â Â Â Â  tailscale ip -4 || echo "Tailscale IP not found"
â€ŽÂ Â Â Â Â Â Â Â Â  echo ""
â€ŽÂ Â Â Â Â Â Â Â Â  echo "ðŸ”‘ tmate SSH session:"
â€ŽÂ Â Â Â Â Â Â Â Â  cat $HOME/.tmate.sock/ssh
â€Ž 
â€ŽÂ Â Â Â Â  - name: Sleep to keep VPS alive
â€ŽÂ Â Â Â Â Â Â  run: sleep 21600Â  # 6 hours
â€Ž 
â€ŽÂ Â Â Â Â  - name: Backup VPS data and tailscale state
â€ŽÂ Â Â Â Â Â Â  run: |
â€ŽÂ Â Â Â Â Â Â Â Â  sudo mkdir -p /opt/vps-backup/data
â€ŽÂ Â Â Â Â Â Â Â Â  sudo cp /var/lib/tailscale/tailscaled.state /opt/vps-backup/data/
â€ŽÂ Â Â Â Â Â Â Â Â  sudo chown -R $USER:$USER /opt/vps-backup
â€ŽÂ Â Â Â Â Â Â Â Â  zip -r backup.zip /opt/vps-backup
â€Ž 
â€ŽÂ Â Â Â Â  - name: Upload VPS backup artifact
â€ŽÂ Â Â Â Â Â Â  uses: actions/upload-artifact@v4
â€ŽÂ Â Â Â Â Â Â  with:
â€ŽÂ Â Â Â Â Â Â Â Â  name: vps-backup
â€ŽÂ Â Â Â Â Â Â Â Â  path: backup.zip
â€Ž 
â€Ž 
â€Ž
